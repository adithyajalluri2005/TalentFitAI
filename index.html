<!DOCTYPE html>
<html lang="en" ng-app="RecruitmentApp">
<head>
  <meta charset="UTF-8">
  <title>Recruitment Assistant</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <style>
    body { font-family: Arial; background: #f4f6f9; margin: 0; text-align: center; }
    .container { max-width: 800px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    input, textarea, button { width: 95%; margin: 10px 0; padding: 10px; border-radius: 6px; }
    button { background: #007BFF; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #0056b3; }
    .section { text-align: left; margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
    pre { background: #272822; color: #f8f8f2; padding: 10px; border-radius: 6px; overflow-x: auto; }
  </style>
</head>
<body ng-controller="RecruitmentCtrl">
  <div class="container">
    <h1>Recruitment Assistant</h1>

    <!-- Upload Resume -->
    <label>Upload Resume:</label>
    <input type="file" id="resume" />
    <button ng-click="uploadResume()">1️⃣ Upload Resume</button>

    <!-- Upload JD -->
    <label>Job Description:</label>
    <textarea id="jd_text" placeholder="Paste the JD here..."></textarea>
    <button ng-click="uploadJD()" ng-disabled="!threadId">2️⃣ Upload JD</button>

    <!-- Match, Assessment, Interview, Skill Gap -->
    <button ng-click="matchResumeJD()" ng-disabled="!threadId">3️⃣ Match Resume with JD</button>
    <button ng-click="generateAssessment()" ng-disabled="!threadId">4️⃣ Generate Assessment</button>
    <button ng-click="generateInterview()" ng-disabled="!threadId">5️⃣ Generate Interview Questions</button>
    <button ng-click="analyzeSkillGap()" ng-disabled="!threadId">6️⃣ Skill Gap Analysis</button>

    <!-- Results Sections -->
    <div class="section" ng-if="results.resumeSkills">
      <h3>Extracted Resume Skills</h3>
      <pre>{{ results.resumeSkills | json }}</pre>
    </div>

    <div class="section" ng-if="results.jdSkills">
      <h3>Extracted JD Skills</h3>
      <pre>{{ results.jdSkills | json }}</pre>
    </div>

    <div class="section" ng-if="results.match">
      <h3>Resume-JD Match</h3>
      <p><b>Match Score:</b> {{ results.match.match_score }}</p>
      <p><b>Matched Skills:</b> {{ results.match.matched_skills.join(', ') }}</p>
      <p><b>Missing Skills:</b> {{ results.match.missing_skills.join(', ') }}</p>
    </div>

    <div class="section" ng-if="results.mcqs">
      <h3>Generated Assessment (MCQs)</h3>
      <pre>{{ results.mcqs | json }}</pre>
    </div>

    <div class="section" ng-if="results.interview">
      <h3>Generated Interview Questions</h3>
      <pre>{{ results.interview | json }}</pre>
    </div>

    <div class="section" ng-if="results.skill_gap">
      <h3>Skill Gap Analysis</h3>
      <p><b>Missing Skills:</b> {{ results.skill_gap.missing_skills.join(', ') }}</p>
      <pre>{{ results.skill_gap.skill_resources | json }}</pre>
    </div>
  </div>

  <script>
    angular.module("RecruitmentApp", [])
      .controller("RecruitmentCtrl", function($scope) {
        const API_BASE = "http://127.0.0.1:8000";
        $scope.threadId = null;
        $scope.state = {}; // Holds CandidateState
        $scope.results = {};

        // 1️⃣ Upload Resume
        $scope.uploadResume = async function() {
          const file = document.getElementById("resume").files[0];
          if (!file) return alert("Upload resume first.");
          let formData = new FormData();
          formData.append("resume", file);

          try {
            const res = await fetch(`${API_BASE}/resume-upload`, { method: "POST", body: formData });
            const data = await res.json();
            $scope.threadId = data.thread_id;
            $scope.state = data.state;
            $scope.results.resumeSkills = data.resume_skills;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("Resume upload failed.");
          }
        };

        // 2️⃣ Upload JD
        $scope.uploadJD = async function() {
          const jdText = document.getElementById("jd_text").value;
          if (!jdText) return alert("Enter JD text.");
          $scope.state.jd_text = jdText;

          try {
            const res = await fetch(`${API_BASE}/jd-upload`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ state: $scope.state, thread_id: $scope.threadId })
            });
            const data = await res.json();
            $scope.state = data.state;
            $scope.results.jdSkills = data.jd_skills;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("JD upload failed.");
          }
        };

        // 3️⃣ Match Resume with JD
        $scope.matchResumeJD = async function() {
          try {
            const res = await fetch(`${API_BASE}/match`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ state: $scope.state, thread_id: $scope.threadId })
            });
            const data = await res.json();
            $scope.state = data.state;
            $scope.results.match = data;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("Match failed.");
          }
        };

        // 4️⃣ Generate Assessment
        $scope.generateAssessment = async function() {
          try {
            const res = await fetch(`${API_BASE}/assessment`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ state: $scope.state, thread_id: $scope.threadId })
            });
            const data = await res.json();
            $scope.state = data.state;
            $scope.results.mcqs = data.mcqs;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("Assessment generation failed.");
          }
        };

        // 5️⃣ Generate Interview Questions
        $scope.generateInterview = async function() {
          $scope.state.resume_text = "Extracted Resume Text"; // placeholder
          try {
            const res = await fetch(`${API_BASE}/interview`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ state: $scope.state, thread_id: $scope.threadId })
            });
            const data = await res.json();
            $scope.state = data.state;
            $scope.results.interview = data.interview_questions;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("Interview generation failed.");
          }
        };

        // 6️⃣ Skill Gap Analysis
        $scope.analyzeSkillGap = async function() {
          try {
            const res = await fetch(`${API_BASE}/skill-gap`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ state: $scope.state, thread_id: $scope.threadId })
            });
            const data = await res.json();
            $scope.state = data.state;
            $scope.results.skill_gap = data;
            $scope.$apply();
          } catch (err) {
            console.error(err); alert("Skill Gap Analysis failed.");
          }
        };
      });
  </script>
</body>
</html>
